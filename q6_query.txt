EJSON.stringify(db.sales.aggregate([{$match:{saleDate:{$gte:ISODate("2015-01-01"),$lt:ISODate("2016-01-01")}}},{$unwind:"$items"},{$group:{_id:{$dateToString:{format:"%Y-%m",date:"$saleDate"}},revenue:{$sum:{$multiply:["$items.price","$items.quantity"]}}}},{$project:{_id:0,month:"$_id",revenue:{$toDouble:"$revenue"}}},{$sort:{month:1}}]).toArray(), null, 0)
